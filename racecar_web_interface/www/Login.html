<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/dashboard.css">

    <title>Login</title>
</head>
<body style="background-color: lightblue;">
  <div class="login-container" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(211, 211, 211, 0.75)">
    <h1>Connexion au Racecar</h1>
    <form id="loginForm" style="text-align: right;">
        <label for="username">Nom d'utilisateur</label>
        <input type="text" id="username" name="username" required>
        <br>
        <label for="ipAddress"> Adresse IP: </label>
        <input type="text" id="ipAddress" name="ipAddress" placeholder="192.168.137.156" required>
        <br>
        <input type="submit" value="Soumettre">
    </form>
  </div>

  <!-- JavaScript, import frameworks -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="js/jquery-3.3.1.slim.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/roslib.min.js"></script> <!-- rosbridge -->

    <script>
      document.getElementById("loginForm").addEventListener("submit", function(event) {
        event.preventDefault();
        connectROS();
      });

      function connectROS() {
        // This function connects to the rosbridge server
        const ipAddress = document.getElementById("ipAddress").value;
        const ipRegex = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;
        if (!ipRegex.test(ipAddress)) {
          alert("Invalid IP address format. Please enter a valid IP address.");
          return
        }
        rbServer = new ROSLIB.Ros({
            // Assuming ros server IP is ipAddress
          url : 'ws://'+ipAddress+':9090'
        });

        rbServer.on('connection', function(){
            console.log('Connected to websocket server.');
            // Redirect to the second page
            sessionStorage.setItem('username', document.getElementById("username").value);
            sessionStorage.setItem('password', ipAddress);
            window.location.href = 'MainPage.html';
        });
        rbServer.on('error', function(error) {
          console.log('Error connecting to websocket server: ', error);
        });

        rbServer.on('close', function() {
            console.log('Connection to websocket server closed.');
        });
      }

    </script>
</body>
</html>